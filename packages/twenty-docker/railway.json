{
  "$schema": "https://railway.app/railway.schema.json",
  "services": [
    {
      "name": "server",
      "dockerfilePath": "twenty/Dockerfile",
      "build": {
        "builder": "NIXPACKS"
      },
      "deploy": {
        "startCommand": "/app/entrypoint.sh node dist/src/main",
        "healthcheckPath": "/healthz",
        "healthcheckTimeout": 5000,
        "healthcheckInterval": 5000,
        "healthcheckRetries": 20,
        "ports": [3000],
        "environment": {
          "PG_DATABASE_URL": "${DATABASE_URL}",
          "REDIS_URL": "${REDIS_URL}",
          "SERVER_URL": "${RAILWAY_STATIC_URL}",
          "APP_SECRET": "${APP_SECRET}",
          "NODE_OPTIONS": "--max-old-space-size=4096"
        }
      }
    },
    {
      "name": "worker",
      "dockerfilePath": "twenty/Dockerfile",
      "build": {
        "builder": "NIXPACKS"
      },
      "deploy": {
        "startCommand": "/app/entrypoint.sh yarn worker:prod",
        "environment": {
          "PG_DATABASE_URL": "${DATABASE_URL}",
          "REDIS_URL": "${REDIS_URL}",
          "SERVER_URL": "${RAILWAY_STATIC_URL}",
          "APP_SECRET": "${APP_SECRET}",
          "NODE_OPTIONS": "--max-old-space-size=4096"
        }
      }
    }
  ]
}
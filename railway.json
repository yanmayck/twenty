{
    "$schema": "https://railway.app/railway.schema.json",
    "build": {
        "builder": "DOCKERFILE"
    },
    "deploy": {
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 10
    },
    "services": {
        "twenty-postgres": {
            "image": "postgres:16",
            "env": {
                "POSTGRES_USER": "${POSTGRES_USER}",
                "POSTGRES_PASSWORD": "${POSTGRES_PASSWORD}",
                "POSTGRES_DB": "${POSTGRES_DB}"
            },
            "volumes": [
                {
                    "mountPath": "/var/lib/postgresql/data"
                }
            ]
        },
        "twenty-redis": {
            "image": "redis:7",
            "env": {
                "ALLOW_EMPTY_PASSWORD": "yes"
            }
        },
        "twenty-server": {
            "image": "twentycrm/twenty:latest",
            "dependsOn": [
                "twenty-postgres",
                "twenty-redis"
            ],
            "env": {
                "PORT": "3000",
                "PG_DATABASE_URL": "${{ twenty-postgres.DATABASE_URL }}",
                "REDIS_URL": "${{ twenty-redis.REDIS_URL }}",
                "SERVER_URL": "https://${{ RAILWAY_PUBLIC_DOMAIN }}",
                "FRONT_BASE_URL": "https://${{ RAILWAY_PUBLIC_DOMAIN }}",
                "IS_MULTIWORKSPACE_ENABLED": "true",
                "IS_BILLING_ENABLED": "true",
                "SIGN_IN_PREFILLED": "true",
                "NODE_OPTIONS": "--max-old-space-size=4096",
                "ACCESS_TOKEN_SECRET": "${{ secret() }}",
                "LOGIN_TOKEN_SECRET": "${{ secret() }}",
                "REFRESH_TOKEN_SECRET": "${{ secret() }}",
                "FILE_TOKEN_SECRET": "${{ secret() }}",
                "EMAIL_FROM_ADDRESS": "noreply@example.com",
                "EMAIL_DRIVER": "smtp",
                "EMAIL_SMTP_HOST": "",
                "EMAIL_SMTP_PORT": "587",
                "EMAIL_SMTP_USER": "",
                "EMAIL_SMTP_PASSWORD": "",
                "STORAGE_TYPE": "local",
                "STORAGE_S3_REGION": "",
                "STORAGE_S3_NAME": "",
                "STORAGE_S3_ENDPOINT": "",
                "STORAGE_S3_ACCESS_KEY_ID": "",
                "STORAGE_S3_SECRET_ACCESS_KEY": "",
                "OPENAI_API_KEY": ""
            }
        }
    }
}
